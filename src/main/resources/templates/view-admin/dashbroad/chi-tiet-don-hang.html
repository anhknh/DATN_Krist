<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Size</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.2/css/all.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.2/css/sharp-thin.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.2/css/sharp-solid.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.2/css/sharp-regular.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.2/css/sharp-light.css">
    <link rel="stylesheet" href="/css/StyleHomePage.css">
    <link rel="stylesheet" href="/css/ProductDetail.css">
    <link rel="stylesheet" href="/css/ban-hang.css">
    <link rel="stylesheet" href="/css/DonHang.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden; /* Ẩn thanh cuộn của body */
        }
        .main {
            height: 100%;
            display: flex;
        }
        .col-10 {
            height: 100vh; /* Đảm bảo chiều cao bằng chiều cao màn hình */
            overflow-y: auto; /* Cho phép cuộn nội dung khi vượt quá chiều cao */
            padding: 12px 32px 48px;
            background-color: #f6f6f6;
        }
        .d-flex {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .step-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #f1f1f1;
            color: #6c757d;
            font-size: 1.5rem;
        }

        .step.active {
            background-color: #000; /* Màu tối cho bước đang hoạt động */
            color: #fff;
        }

        .step-description {
            margin-top: 8px;
            font-size: 14px;
            color: #555;
            text-align: center;
        }

        .line {
            flex-grow: 1;
            height: 2px;
            border-top: 2px dashed #ddd;
            margin: 0 10px; /* Tạo khoảng cách giữa các vòng tròn */
        }

    </style>
</head>
<body class="overflow-hidden">
<div class="main" >
    <div class="container-fluid g-0">
        <div class="row g-0">
            <!--            sider bar-->
            <div class="col-2" style="height: 100vh;">
                <div style="height: 72px; margin-bottom: 42px;"
                     class="d-flex align-items-center justify-content-center">
                    <div>
                        <img style="width: 78%" src="/uploadImage/logo.png" alt="logo">
                    </div>
                    <div style="font-size: 20px; font-weight: 800; margin-left: 12px;">
                        Krist
                    </div>
                </div>
                <!-- Main Menu Items -->
                <div style="padding: 0px 22px 28px; border-bottom: 1px solid #E9E9EB;" class="mb-4">
                    <!--                    Hiện tại vẫn chưa có tính năng doanh thu đường dẫn là #-->
                    <a href="/quan-ly/thong-ke" class=" mb-3"
                       style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; text-decoration: none; color: #000; display:block;"
                       onclick="highlightLink(this)">
                        <i class="fa-light fa-objects-column" style="margin-right: 10px;"></i>Doanh thu
                    </a>
                    <a href="/quan-ly/ban-hang" class=" mb-3"
                       style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; text-decoration: none; color: #000; display:block;" onclick="highlightLink(this)">
                        <i class="fa-light fa-cart-shopping" style="margin-right: 10px;"></i> Bán hàng
                    </a>
                    <a href="/quan-ly/pagination-san-pham" class="mb-3"
                       style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; text-decoration: none; color: #000; display:block;" onclick="highlightLink(this)">
                        <i class="fa-regular fa-shirt" style="margin-right: 10px;"></i> Sản phẩm
                    </a>
                    <!-- Product Management Tree Menu -->
                    <div class="menu-item mb-3">
                        <p style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; color: #000; display: flex; align-items: center; cursor: pointer;"
                           onclick="toggleSubmenu('productSubMenu')">
                            <i class="fa-regular fa-box-archive" style="margin-right: 10px;"></i> Thuộc tính
                            <i class="fa fa-chevron-down" style="margin-left:auto;"></i>
                        </p>
                        <ul id="productSubMenu" class="submenu"
                            style="list-style: none; padding-left: 20px; display: none;">
                            <li style="padding: 8px 12px;">
                                <a href="/quan-ly/pagination-danh-muc"
                                   style="text-decoration: none; color: #000;" onclick="highlightLink(this)">Danh
                                    mục</a>
                            </li>
                            <li style="padding: 8px 12px;">
                                <a href="/quan-ly/pagination-chat-lieu"
                                   style="text-decoration: none; color: #000;" onclick="highlightLink(this)">Chất liệu</a>
                            </li>
                            <li style="padding: 8px 12px;">
                                <a href="/quan-ly/pagination-mau-sac"
                                   style="text-decoration: none; color: #000;" onclick="highlightLink(this)">Màu sắc</a>
                            </li>
                            <li style="padding: 8px 12px;">
                                <a href="/quan-ly/pagination-size"
                                   style="text-decoration: none; color: #000;" onclick="highlightLink(this)">Size</a>
                            </li>
                            <li style="padding: 8px 12px;">
                                <a href="/quan-ly/pagination-tay-ao" style="text-decoration: none; color: #000;" onclick="highlightLink(this)">Tay
                                    áo</a>
                            </li>
                            <li style="padding: 8px 12px;">
                                <a href="/quan-ly/pagination-co-ao" style="text-decoration: none; color: #000;" onclick="highlightLink(this)">Cổ
                                    áo</a>
                            </li>
                        </ul>
                    </div>
                    <!--                    Chức năng chưa có đường dẫn là #-->
                    <a href="/quan-ly/view-don-hang" class="bg_profile_btn mb-3" onclick="highlightLink(this)"
                       style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; text-decoration: none; color: #000; display:block;" >
                        <i class="fa-light fa-cart-flatbed" style="margin-right: 10px;"></i> Đơn hàng
                    </a>
                    <a href="/quan-ly/pagination-khuyen-mai" class=" mb-3" onclick="highlightLink(this)"
                       style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; text-decoration: none; color: #000; display:block;">
                        <i class="fa-light fa-tickets-perforated" style="margin-right: 10px;"></i> Khuyến mại
                    </a>
                    <!--                    Chức năng chưa có đường dẫn là #-->
                    <a href="/quan-ly/pagination-khach-hang" class="mb-3" onclick="highlightLink(this)"
                       style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; text-decoration: none; color: #000; display:block;">
                        <i class="fa-light fa-user-group" style="margin-right: 10px;"></i> Khách hàng
                    </a>
                    <a href="/quan-ly-admin/phan-trang-nhan-vien" class="mb-3" onclick="highlightLink(this)"
                       style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; text-decoration: none; color: #000; display:block;">
                        <i class="fa-light fa-user" style="margin-right: 10px;"></i> Nhân viên
                    </a>
                    <!--                    Chức năng chưa có đường dẫn là #-->


                    <!--                    Chức năng chưa có đường dẫn là #-->
                    <a href="/quan-ly/setting" class="mb-3" onclick="highlightLink(this)"
                       style="padding: 8px 24px; font-size: 14px; font-weight: 500; border-radius: 6px; text-decoration: none; color: #000; display:block;">
                        <i class="fa-light fa-gear" style="margin-right: 10px;"></i> Cài đặt
                    </a>
                </div>
            </div>
            <!--            end sider bar-->
            <div class="col-10">
                <!-- navigator_link -->
                <div class="d-flex justify-content-between align-items-center" style="height: 72px; margin-bottom: 18px;">
                    <div>
                        <nav style="--bs-breadcrumb-divider: '>'; line-height: 40px;" aria-label="breadcrumb" >
                            <ol class="breadcrumb" style="height: 40px; margin: 0px;">
                                <li class="breadcrumb-item "><a href="/quan-ly/view-don-hang" class="nav_link">Đơn hàng</a></li>
                                <li class="breadcrumb-item "><a href="#" class="nav_link_active">Chi tết đơn hàng</a></li>
                            </ol>
                        </nav>
                    </div>
                    <div>
                        <a href="/logout" style="text-decoration: none; color: #000; font-size: 20px;"><i class="fa-thin fa-arrow-right-from-bracket"></i></a>
                    </div>
                </div>
                <!--                content-->
                <div style="display: flex; justify-content: space-between">
                    <div class="box" style="margin-right: 12px; flex: 1">
                        <div style="font-size: 18px; font-weight: 700; margin: 12px">Thông tin đơn hàng</div>
                        <div>
                            <div class="d-flex justify-content-between" style="margin-bottom: 18px;">
                                <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Mã đơn hàng:</div>
                                <div style="font-size: 16px; font-weight: 500;">
                                    <span th:text="${hoaDon.maHoaDon}"></span>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between" style="margin-bottom: 18px;">
                                <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Trạng thái đơn hàng:</div>
                                <div style="font-size: 16px; font-weight: 500;">
                                    <span th:text="${convertMoney.formatStatus(hoaDon.trangThai)}"></span>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between" style="margin-bottom: 18px;">
                                <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Thông tin thanh toán:</div>
                                <div style="font-size: 16px; font-weight: 500;">
                                    <span th:text="${convertMoney.formatStatus(hoaDon.trangThaiThanhToan)}"></span>
                                </div>
                            </div>
                            <div th:if="${hoaDon.khuyenMai != null}" class="d-flex justify-content-between" style="margin-bottom: 18px;">
                                <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Tên khuyến mại:</div>
                                <div style="font-size: 16px; font-weight: 500;">
                                    <span th:text="${hoaDon.khuyenMai.tenKhuyenMai}"></span>
                                </div>
                            </div>
                            <div th:if="${hoaDon.khuyenMai != null}" class="d-flex justify-content-between" style="margin-bottom: 18px;">
                                <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Mức giảm:</div>
                                <div style="font-size: 16px; font-weight: 500;">
                                    <span th:text="${convertMoney.formatCurrency(hoaDon.khuyenMai.giaTri)} + ' ' + ${hoaDon.khuyenMai.kieuKhuyenMai ? '%' : 'VND'}"></span>
                                </div>
                            </div>
                            <div th:if="${hoaDon.khuyenMai != null}" class="d-flex justify-content-between" style="margin-bottom: 18px;">
                                <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Mức giảm tối đa:</div>
                                <div style="font-size: 16px; font-weight: 500;">
                                    <span th:text="${convertMoney.formatCurrency(hoaDon.khuyenMai.mucGiamToiDa)} + ' VND'"></span>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between" style="margin-bottom: 18px;">
                                <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Tổng tiền:</div>
                                <div style="font-size: 16px; font-weight: 500;">
                                    <span th:text="${convertMoney.formatCurrency(hoaDon.tongTien)}"></span>
                                </div>
                            </div>

                            <!-- Form chỉnh sửa phí vận chuyển -->
                            <div th:if="${hoaDon.trangThai != T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN &&
                            hoaDon.trangThai != T(com.example.kristp.enums.HoaDonStatus).DANG_XU_LY }"
                                    class="d-flex justify-content-between" style="margin-bottom: 18px;">
                                <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Phí giao hàng:</div>
                                <div style="font-size: 16px; font-weight: 500;"><span id="shipping-fee" th:text="${convertMoney.formatCurrency(hoaDon.phiVanChuyen)}">30.000</span></div>
                            </div>
                            <form th:if="${hoaDon.trangThai == T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN ||
                            hoaDon.trangThai == T(com.example.kristp.enums.HoaDonStatus).DANG_XU_LY }"
                                    id="formShip" class="needs-validation" novalidate th:action="@{/quan-ly/doi-phi-van-chuyen}" method="post">
                                <div class="d-flex justify-content-between align-items-center" style="margin-bottom: 18px;">
                                    <div style="font-size: 16px; font-weight: 500; color: #5C5F6A;">Phí giao hàng:</div>
                                    <input type="hidden" name="orderId" th:value="${hoaDon.id}">
                                    <div>
                                        <input type="number" min="0" class="form-control" name="shippingFee" style="width: 150px;"
                                               th:value="${hoaDon.phiVanChuyen}" required>
                                        <div class="invalid-feedback">Phí giao hàng phải từ 0 trở lên</div>
                                    </div>
                                </div>
                            </form>

                            <div class="d-flex justify-content-between" style="margin-top: 18px;">
                                <div style="font-size: 16px; font-weight: bold;">Tổng tiền sau giảm:</div>
                                <div style="font-size: 16px; font-weight: bold;">
                                    <span id="final-total" th:text="${convertMoney.calculatorTotal(hoaDon.tongTien, hoaDon.khuyenMai, hoaDon.phiVanChuyen)}"></span>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="mt-3 mb-3 me-3" style="text-align: center">
                                <button class="btn btn-dark btn-sm" th:onclick="'inHoaDon(' + ${idHoaDonSelected} + ')'">In hóa đơn</button>
                            </div>
                            <div th:if="${hoaDon.trangThai == T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN ||
                            hoaDon.trangThai == T(com.example.kristp.enums.HoaDonStatus).DANG_XU_LY }"
                                    style="text-align: center;">
                                <button id="btn-submit-ship" class="btn btn-dark btn-sm">Lưu câp nhật</button>
                            </div>
                        </div>
                    </div>

                    <div class="box" style="flex: 2">
                        <div class="d-flex align-items-center"
                             th:if="${hoaDon.trangThai != T(com.example.kristp.enums.HoaDonStatus).DA_HUY}"
                             style="margin: 24px">
                            <div class="step-container">
                                <!--                        Thêm hoặc xóa class active để nó hiện màu đen hoặc xám-->
                                <div class="step" th:classappend="${hoaDon.getTrangThai() == T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN} ? 'active' : ''">
                                    <i class="fa-sharp fa-regular fa-hourglass-start"></i>
                                </div>
                                <span class="step-description">Chờ xác nhận</span>
                            </div>
                            <div class="line"></div>
                            <div class="step-container">
                                <div class="step" th:classappend="${hoaDon.getTrangThai() == T(com.example.kristp.enums.HoaDonStatus).DANG_XU_LY} ? 'active' : ''">
                                    <i class="fa-regular fa-box-open-full"></i>
                                </div>
                                <span class="step-description">Đang xử lý</span>
                            </div>
                            <div class="line"></div>
                            <div class="step-container">
                                <div class="step" th:classappend="${hoaDon.getTrangThai() == T(com.example.kristp.enums.HoaDonStatus).DANG_GIAO_HANG} ? 'active' : ''">
                                    <i class="fa-light fa-truck-fast"></i>
                                </div>
                                <span class="step-description">Đang giao hàng</span>
                            </div>
                            <div class="line"></div>
                            <div class="step-container">
                                <div class="step" th:classappend="${hoaDon.getTrangThai() == T(com.example.kristp.enums.HoaDonStatus).HOAN_TAT} ? 'active' : ''">
                                    <i class="fa-light fa-hand-holding-heart"></i>
                                </div>
                                <span class="step-description">Hoàn tất</span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center"
                             th:if="${hoaDon.trangThai == T(com.example.kristp.enums.HoaDonStatus).DA_HUY}"
                             style="margin: 24px">
                            <div class="step-container">
                                <!--                        Thêm hoặc xóa class active để nó hiện màu đen hoặc xám-->
                                <div class="step" th:classappend="${hoaDon.getTrangThai() == T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN} ? 'active' : ''">
                                    <i class="fa-sharp fa-regular fa-hourglass-start"></i>
                                </div>
                                <span class="step-description">Chờ xác nhận</span>
                            </div>
                            <div class="line"></div>
                            <div class="step-container">
                                <div class="step" th:classappend="${hoaDon.getTrangThai() == T(com.example.kristp.enums.HoaDonStatus).DA_HUY} ? 'active' : ''">
                                    <i class="fa-sharp fa-regular fa-xmark"></i>
                                </div>
                                <span class="step-description">Đã Hủy</span>
                            </div>
                        </div>



                        <div style="display: flex; justify-content: end; margin: 16px">

                            <div th:if="${hoaDon.trangThai != T(com.example.kristp.enums.HoaDonStatus).HOAN_TAT &&
                            hoaDon.trangThai != T(com.example.kristp.enums.HoaDonStatus).DA_HUY}">
                                <div data-bs-toggle="modal" data-bs-target="#exampleModal" class="btn btn-dark" style="color: #fff; text-decoration: none"
                                   >
                                    <i class="fa-sharp fa-regular fa-arrow-right"></i> Chuyển trạng thái
                                </div>
                            </div>

                        </div>
                        <div>
                            <div>
                                <h5 class="card-title "
                                    style="font-weight: bold; margin-bottom: 0;"
                                   >Địa chỉ giao hàng</h5>
                            </div>
                            <div  class="mt-4">
                                <div>
                                    <div>
                                        <h5 class="card-title "
                                            style="font-weight: bold; margin-bottom: 0;"
                                            th:text="${hoaDon.diaChi.tenKhachHang}">Đoàn Hiếu</h5>
                                    </div>
                                </div>
                                <p class="card-text"
                                   style="margin-top: 0.5rem; display: flex; align-items: center;">
                                    <i class="fa-light fa-location-dot"
                                       style="margin-right: 8px;"></i>
                                    <span th:text="${convertMoney.formatFullAddress(hoaDon.diaChi.diaChi, hoaDon.diaChi.tenPhuongXa, hoaDon.diaChi.tenQuanHuyen, hoaDon.diaChi.tenTinhThanh)}">Lê Đức Thọ, Hà Nội</span>
                                </p>

                                <p class="card-text"
                                   style="margin-top: 0.5rem; display: flex; align-items: center;">
                                    <i class="fa-sharp fa-light fa-phone"
                                       style="margin-right: 8px;"></i>
                                    <span th:text="${hoaDon.diaChi.sdt}">0987654321</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="box mt-2">
                    <div style="font-size: 18px; font-weight: 700; margin: 12px">Chi tiết sản phẩm - đơn hàng</div>
                    <div style="text-align: end">
                        <div style="display: flex; justify-content: end; margin: 16px" class="d-inline-block" th:if="${hoaDon.trangThai == T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN}">
                            <div class="btn btn-dark"
                                 th:attr="data-order-id-add=${hoaDon.id}"
                                 data-bs-toggle="modal" data-bs-target="#productModal"
                                 id="addProductButton"
                            >
                                <i class="fa-light fa-cart-plus"></i> Thêm sản phẩm
                            </div>
                        </div>
                        <div style="display: flex; justify-content: end; margin: 16px" class="d-inline-block" th:if="${hoaDon.trangThai == T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN}">
                            <div class="btn btn-dark btn-cancel-order"
                                 th:attr="data-order-id=${hoaDon.id}"
                                 data-bs-toggle="modal"
                                 data-bs-target="#cancelOrderModal"
                            >
                                <i class="fa-sharp fa-regular fa-xmark"></i> Hủy đơn hàng
                            </div>
                        </div>
                    </div>
                    <div>

                        <div th:if="${hoaDon.trangThai == T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN}">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th style="width: 10%; text-align: center;">Ảnh</th>
                                    <th style="width: 20%; text-align: center;">Thông tin</th>
                                    <th style="width: 15%; text-align: center;">Giá</th>
                                    <th style="width: 15%; text-align: center;">Số lượng</th>
                                    <th style="width: 15%; text-align: center;">Tổng cộng</th>
                                    <th style="width: 20%; text-align: center;">Hành động</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="item : ${hoaDonChiTiet}">

                                    <!-- Cột Hình ảnh -->
                                    <td style="text-align: center; vertical-align: middle;">
                                        <div class="d-flex justify-content-center align-items-center"
                                             style="background-color: #f6f6f6; border-radius: 4px; width: 46px; height: 46px; margin: 0 auto">
                                            <div th:style="|width: 46px; height: 46px; background: url('/img/${item.chiTietSanPham.anhSanPham}') no-repeat center center / cover;|">
                                            </div>
                                        </div>
                                    </td>

                                    <!-- Cột Thông tin -->
                                    <td>
                                        <!-- Tên sản phẩm -->
                                        <p style="font-size: 16px; font-weight: 500; text-align: center"
                                           th:text="${item.getChiTietSanPham().sanPham.tenSanPham}"></p>
                                        <!-- Màu sắc và kích thước -->
                                        <div class="d-flex align-items-center" style="margin-top: 8px;">
                                            <span style="margin-right: 8px;">Color:</span>
                                            <div th:style="'padding: 8px; border-radius: 50%; background-color: ' + ${item.getChiTietSanPham().mau.maMauSac}"></div>
                                            <span style="margin-left: 16px;">Size: <span
                                                    th:text="${item.getChiTietSanPham().size.tenSize}"></span></span>
                                        </div>
                                    </td>
                                    <!-- Cột Giá -->
                                    <td style="text-align: center; vertical-align: middle;">
                                <span th:text="${convertMoney.formatCurrency(item.getChiTietSanPham().donGia)}"
                                      class="product-price" th:id="'gia-' + ${item.id}"></span>
                                    </td>
                                    <!-- Cột Số lượng -->
                                    <td style="text-align: center; vertical-align: middle;">
                                        <div class="d-flex justify-content-between align-items-center"
                                             style="padding: 8px 18px; border-radius: 4px;
                                              width: 107px; height: 40px; margin: 0 auto">
                                            <span th:id="'soLuong-' + ${item.id}" th:text="${item.soLuong}"
                                                  class="product-quantity"></span>
                                        </div>
                                    </td>
                                    <!-- Cột Tổng cộng -->
                                    <td style="text-align: center; vertical-align: middle;">
                                <span th:text="${convertMoney.formatCurrency(item.getChiTietSanPham().donGia * item.soLuong)}"
                                      th:id="'tong-' + ${item.id}"
                                      class="product-total"></span>
                                    </td>
                                    <!-- Cột Hành động -->
                                    <td style="text-align: center; vertical-align: middle;">
                                        <div class="d-inline-block me-3" data-bs-toggle="tooltip"
                                             data-bs-placement="top" title="Cập nhật">
                                            <div data-bs-toggle="modal" data-bs-target="#modalUpdateCart" th:data-id="${item.id}"
                                                 th:data-quantity="${item.soLuong}">
                                                <i class="fa-sharp fa-regular fa-pen-to-square"></i>
                                            </div>
                                        </div>
                                        <div class="d-inline-block">
                                            <a style="color: #e10a0a; text-decoration: none;" data-bs-toggle="tooltip"
                                               data-bs-placement="top" title="Xóa"
                                               th:href="@{/quan-ly/xoa-san-pham-don(id=${item.id})}">
                                                <i class="fa-regular fa-trash-can"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>

                                </tbody>
                            </table>
                        </div>

                        <!-- Danh sách sản phẩm -->
                        <div class="product-list"  th:if="${hoaDon.trangThai != T(com.example.kristp.enums.HoaDonStatus).CHO_XAC_NHAN}">
                            <div class="product-item d-flex align-items-start"
                                 th:each="item : ${hoaDonChiTiet}"
                                 style="border: 1px solid #e6e7e8; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <!-- Hình ảnh sản phẩm -->
                                <div style="flex: 1; max-width: 80px;">
                                    <div style="width: 80px; height: 80px; border-radius: 8px; background-color: #f6f6f6;">
                                        <div th:style="|width: 100%; height: 100%; background: url('/uploadImage/${item.chiTietSanPham.anhSanPham}') no-repeat center center / cover;|">
                                        </div>
                                    </div>
                                </div>

                                <!-- Thông tin sản phẩm -->
                                <div style="flex: 3; margin-left: 16px;">
                                    <!-- Tên sản phẩm -->
                                    <p style="font-size: 16px; font-weight: 500; text-align: center"
                                       th:text="${item.getChiTietSanPham().sanPham.tenSanPham}"></p>
                                    <!-- Màu sắc và kích thước -->
                                    <div class="d-flex align-items-center" style="margin-top: 8px;">
                                        <span style="margin-right: 8px;">Color:</span>
                                        <div th:style="'width: 20px; height: 20px; border-radius: 50%; background-color: ' + ${item.getChiTietSanPham().mau.maMauSac}"></div>
                                        <span style="margin-left: 16px;">Size:
                                                            <span th:text="${item.getChiTietSanPham().size.tenSize}"></span>
                                                        </span>
                                    </div>
                                </div>

                                <!-- Giá và số lượng -->
                                <div style="flex: 2; margin-left: auto; text-align: right;">
                                    <!-- Giá -->
                                    <p style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">
                                        Giá: <span
                                            th:text="${convertMoney.formatCurrency(item.getChiTietSanPham().donGia)}"></span>
                                    </p>
                                    <!-- Số lượng -->
                                    <p style="font-size: 16px;">
                                        Số lượng: <span th:text="${item.soLuong}"></span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!--modal xác nhận chuyển traạng thái-->

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 500px; margin: 0 auto">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Xác nhận chuyển trạng thái</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Sau khi chuyển trạng thái sẽ không thể quay lại!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" data-bs-dismiss="modal">Hủy</button>
                <a  class="btn btn-dark" style="color: #fff; text-decoration: none"  th:href="@{/quan-ly/doi-trang-thai(idHoaDon=${idHoaDonSelected})}">Xác nhận</a>
            </div>
        </div>
    </div>
</div>

<!-- Popup Xác Nhận Hủy -->
<div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-labelledby="cancelOrderLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="justify-content: center">
        <div class="modal-content" style="width: 500px">
            <div class="modal-header">
                <h5 class="modal-title" id="cancelOrderLabel">Xác Nhận Hủy Đơn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="cancelOrderForm" action="/quan-ly/huy-don-hang" method="POST">
                <div class="modal-body">
                    <p>Bạn có chắc chắn muốn hủy đơn hàng này không?</p>
                    <!-- Hidden Input để truyền ID đơn hàng -->
                    <input type="hidden" name="orderId" id="hiddenOrderId">
                </div>
                <div style="padding: 12px; text-align: center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-danger">Xác Nhận Hủy</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!--modal cập nhật giỏ hàng-->
<div class="modal fade" id="modalUpdateCart" tabindex="-1" aria-labelledby="modalCategoriesLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="width: 500px; margin: 0 auto">
            <div class="modal-header">
                <h5 class="modal-title" id="modalCategoriesLabel">Cập nhật số lượng trong giỏ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body"  style="padding:0; display: block">
                <div>
                    <form class="needs-validation" novalidate th:action="@{/quan-ly/cap-nhat-so-luong-don}" method="post">
                        <!-- Hidden ID Field -->
                        <input type="hidden" id="productId" name="inHoaDonChiTiet">

                        <!-- Quantity (Editable) -->
                        <div class="mb-3">
                            <label for="quantity" class="form-label">Số lượng:</label>
                            <input type="number" class="form-control" id="quantity" name="soLuong" min="1" required>
                            <div class="invalid-feedback">Số lượng không hợp lệ</div>
                        </div>
                        <div style="text-align: end;">
                            <button type="submit" class="btn btn-dark">Lưu</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!--modal thêm sản phẩm-->
<div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Danh sách sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="padding-bottom: 0">
                <div style="width: 100%">
                    <div>
                        <table class="table table-bordered">
                            <thead>
                            <tr>
                                <th>Ảnh</th>
                                <th>Tên sản phẩm</th>
                                <th>Màu sắc</th>
                                <th>Size</th>
                                <th>Tay áo</th>
                                <th>Cổ áo</th>
                                <th>Số lượng</th>
                                <th>Giá tiền</th>
                                <th class="text-center">Thao tác</th>
                            </tr>
                            </thead>
                            <tbody id="productTableBody"></tbody>
                        </table>
                    </div>
                    <div>
                        <ul class="pagination justify-content-end" id="paginationControls"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Alert thông báo thất bại -->
<div class="alert alert-danger alert-dismissible fade show position-fixed top-0 end-0 m-3" role="alert" id="alertMessage" style="display: none;">
    <strong>Thất bại!</strong> <span id="alertBody">Thông báo này sẽ hiển thị kết quả.</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
<!-- Alert thông báo từ backend -->
<div th:if="${message}" th:class="${messageType} + ' alert alert-dismissible fade show position-fixed top-0 end-0 m-3'" id="successAlert" role="alert">
    <strong th:text="${titleMsg}">Tiêu đề</strong> <span th:text="${message}">Thông báo này sẽ hiển thị kết quả.</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>

    document.addEventListener("DOMContentLoaded", () => {
        const productModal = document.getElementById("productModal");
        const productTableBody = document.getElementById("productTableBody");
        const pagination = document.getElementById("paginationControls");
        const addProductButton = document.getElementById("addProductButton");
        const orderId = addProductButton.getAttribute("data-order-id-add");



        let currentPage = 1;
        const pageSize = 5;

        // Fetch dữ liệu từ API
        const fetchProducts = (page = 1) => {
            fetch(`/quan-ly/fetch-san-pham?page=${page}&size=5`)
                .then(response => response.json())
                .then(data => {
                    renderProducts(data.content); // Render danh sách sản phẩm
                    renderPagination(data.totalPages, page); // Render phân trang
                })
                .catch(error => console.error("Error fetching products:", error));
        };

        // Render danh sách sản phẩm
        const renderProducts = (products) => {
            productTableBody.innerHTML = "";
            products.forEach(product => {
                const row = document.createElement("tr");
                row.innerHTML = `
                <td>
                    <div class="d-flex justify-content-center align-items-center"
                         style="background-color: #f6f6f6; border-radius: 4px;">
                        <div style="width: 46px; height: 46px; background: url('/uploadImage/${product.anhSanPham}') no-repeat center center / cover;">
                        </div>
                    </div>
                </td>
                <td>${product.sanPham.tenSanPham}</td>
                <td>
                    <div style="width: 42px; height: 12px; background-color: ${product.mau.maMauSac}; border: 1px solid black;"></div>
                </td>
                <td>${product.size.tenSize}</td>
                <td>${product.tayAo.kieuTayAo}</td>
                <td>${product.coAo.kieuCoAo}</td>
                <td>${product.soLuong}</td>
                <td>${formatCurrency(product.donGia)}</td>
                <td class="text-center">
                    <a class="btn btn-dark btn-sm"
                    href="/quan-ly/add-san-pham-don?idHoaDon=${orderId}&idChiTiet=${product.id}"
                    style="color: #fff;text-decoration: none">
                        Thêm
                    </a>
                </td>
            `;
                productTableBody.appendChild(row);
            });
        };

        // Render phân trang
        const renderPagination = (totalPages, currentPage) => {
            pagination.innerHTML = "";

            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement("li");
                pageItem.className = `page-item ${i === currentPage ? "active" : ""}`;
                pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                pageItem.addEventListener("click", (e) => {
                    e.preventDefault();
                    fetchProducts(i);
                });
                pagination.appendChild(pageItem);
            }
        };

        // Định dạng tiền tệ
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat("vi-VN", {
                style: "currency",
                currency: "VND"
            }).format(amount);
        };

        // Thêm sản phẩm vào đơn hàng
        const addToOrder = (productId) => {
            console.log("Thêm sản phẩm ID:", productId);
            // Gửi yêu cầu thêm vào đơn hàng tại đây
            // fetch(`/api/order/add/${productId}`, { method: "POST" });
        };

        // Lắng nghe sự kiện mở modal và tải dữ liệu
        productModal.addEventListener("show.bs.modal", () => {
            fetchProducts(currentPage);
        });
    });




    document.addEventListener('DOMContentLoaded', function () {
        const updateDivs = document.querySelectorAll('div[data-bs-target="#modalUpdateCart"]');

        updateDivs.forEach(div => {
            div.addEventListener('click', function () {
                // Lấy dữ liệu từ các thuộc tính `data-*`
                const productId = div.getAttribute('data-id');
                const quantity = div.getAttribute('data-quantity');

                // Kiểm tra giá trị
                console.log('Product ID:', productId);  // Xem giá trị ID trong console
                console.log('Quantity:', quantity);      // Xem số lượng trong console

                // Gán giá trị vào các input trong modal
                document.getElementById('productId').value = productId;
                document.getElementById('quantity').value = quantity;
            });
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        const submitButton = document.getElementById("btn-submit-ship");
        const form = document.getElementById("formShip");

        submitButton.addEventListener("click", function (event) {
            event.preventDefault(); // Ngăn chặn hành vi submit mặc định nếu cần kiểm tra dữ liệu
            if (form.checkValidity()) {
                form.submit(); // Gửi form nếu dữ liệu hợp lệ
            } else {
                form.reportValidity(); // Hiển thị thông báo lỗi nếu dữ liệu không hợp lệ
            }
        });
    });


    document.querySelectorAll('.btn-cancel-order').forEach(button => {
        button.addEventListener('click', function () {
            console.log("hihi")
            document.getElementById('hiddenOrderId').value = this.getAttribute('data-order-id');
        });
    });
</script>
<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

    // Function to toggle submenu visibility
    function toggleSubmenu(submenuId) {
        const submenu = document.getElementById(submenuId);
        if (submenu.style.display === "none" || submenu.style.display === "") {
            submenu.style.display = "block";
        } else {
            submenu.style.display = "none";
        }
    }
</script>

<script>

    const idCustomer = document.getElementById("idCustomer");
    const valueName = document.querySelectorAll(".valueName");
    const valueDes = document.querySelectorAll(".valueDes");
    // Lấy về thuộc tính có id và điều chỉnh theo mong muốn trong hàm saveIdOrder
    const nameCate = document.getElementById('nameCate');
    const desCate = document.getElementById('desCate');
    const statusSection = document.getElementById('statusSection');

    function inHoaDon(idOrder) {
        $.ajax({
            url: '/hoa-don-pdf/in/' + idOrder,
            method: 'GET',
            xhrFields: {
                responseType: 'blob'
            },
            success: function(data) {
                const filename = "HoaDon.pdf";
                const url = window.URL.createObjectURL(new Blob([data], { type: 'application/pdf' }));
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();

                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            },
            error: function() {
                alert("Lỗi khi in hóa đơn!");
            }
        });
    }


    function saveIdOrder(id , index , hanhDong){
        idCustomer.value = id;
        if(index != null) {
            nameCate.value = valueName[index].textContent.trim();
            desCate.value = valueDes[index].textContent.trim();
            statusSection.classList.remove('display_none');
            document.getElementById('exampleModalLabel').innerText = 'Update material';
            // Kiểm tra class của icon
            if (hanhDong == "ACTIVE") {
                // Nếu class là 'fa-check', chọn radio button active
                document.getElementById('active').checked = true;
            } else {
                // Ngược lại nếu class là 'fa-x', chọn radio button inactive
                document.getElementById('inactive').checked = true;
            }
            document.getElementById("form_submit").action = '/quan-ly/update-size' ;
        } else {
            statusSection.classList.add('display_none');
            document.getElementById('exampleModalLabel').innerText = 'Add material';
            nameCate.value = "";
            desCate.value = "";
            document.getElementById("form_submit").action = '/quan-ly/add-size' ;
        }
    }

    (function () {
        'use strict';
        // Fetch all forms with class 'needs-validation'
        var forms = document.querySelectorAll('.needs-validation');

        // Loop over forms and prevent submission if validation fails
        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                    showAlert( "error", "Đã có lỗi xảy ra. Vui lòng kiểm tra lại.");
                }
                form.classList.add('was-validated');
            }, false);

            // Add 'change' event listener for all inputs to validate them dynamically
            var inputs = form.querySelectorAll('input');
            Array.prototype.slice.call(inputs).forEach(function (input) {
                input.addEventListener('change', function () {
                    if (input.checkValidity()) {
                        input.classList.remove('is-invalid');
                        input.classList.add('is-valid');
                    } else {
                        input.classList.remove('is-valid');
                        input.classList.add('is-invalid');
                        showAlert("error","Dữ liệu không hợp lệ");
                    }
                });
            });
        });

        //thông báo
        function showAlert(type, message) {
            let alertElement;

            if (type === 'success') {
                alertElement = document.getElementById('successAlert');
                alertElement.querySelector('span').textContent = message; // Thiết lập nội dung thông báo thành công
                alertElement.style.display = 'block'; // Hiển thị thông báo thành công
            } else if (type === 'error') {
                alertElement = document.getElementById('alertMessage');
                alertElement.querySelector('#alertBody').textContent = message; // Thiết lập nội dung thông báo lỗi
                alertElement.style.display = 'block'; // Hiển thị thông báo lỗi
            }

            // Tự động ẩn thông báo sau 5 giây
            setTimeout(() => {
    if (alertElement) {
        alertElement.style.display = 'none'; // Ẩn thông báo
    }
}, 5000);
        }

        document.addEventListener('DOMContentLoaded', function (){
            // Kiểm tra và ẩn thông báo thành công nếu có
            var successAlert = document.getElementById('successAlert');
            if (successAlert && successAlert.style.display !== 'none') {
                setTimeout(function () {
                    var bootstrapAlert = new bootstrap.Alert(successAlert);
                    bootstrapAlert.close();
                }, 5000);
            }
        });

    })();
    function toggleSubmenu(id) {
        const submenu = document.getElementById(id);
        // Toggle between 'none' and 'block' to show/hide submenu
        submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
    }

    function highlightLink(link){
        //     Remove the 'bg_profile_btn' class from all links
        const links = document.querySelectorAll('.bg_profile_btn');
        links.forEach(link => {
            link.classList.remove('bg_profile_btn');
        })
        link.classList.add('bg_profile_btn');
    }
</script>
</body>
</html>